//==============================================================================
//
//  x_math_inline.hpp
//
//==============================================================================

#ifndef X_MATH_INLINE_HPP
#define X_MATH_INLINE_HPP
#else
#error "File " __FILE__ " has been included twice!"
#endif

//==============================================================================
//  DEFINITIONS
//==============================================================================

// DOM-IGNORE-BEGIN

//
// Definitions for R_0 thru R_5 are in x_math.hpp.
//
#define R_6     RADIAN(   6 )
#define R_7     RADIAN(   7 )
#define R_8     RADIAN(   8 )
#define R_9     RADIAN(   9 )
#define R_10    RADIAN(  10 )
#define R_11    RADIAN(  11 )
#define R_12    RADIAN(  12 )
#define R_13    RADIAN(  13 )
#define R_14    RADIAN(  14 )
#define R_15    RADIAN(  15 )
#define R_16    RADIAN(  16 )
#define R_17    RADIAN(  17 )
#define R_18    RADIAN(  18 )
#define R_19    RADIAN(  19 )
#define R_20    RADIAN(  20 )
#define R_21    RADIAN(  21 )
#define R_22    RADIAN(  22 )
#define R_23    RADIAN(  23 )
#define R_24    RADIAN(  24 )
#define R_25    RADIAN(  25 )
#define R_26    RADIAN(  26 )
#define R_27    RADIAN(  27 )
#define R_28    RADIAN(  28 )
#define R_29    RADIAN(  29 )
#define R_30    RADIAN(  30 )
#define R_31    RADIAN(  31 )
#define R_32    RADIAN(  32 )
#define R_33    RADIAN(  33 )
#define R_34    RADIAN(  34 )
#define R_35    RADIAN(  35 )
#define R_36    RADIAN(  36 )
#define R_37    RADIAN(  37 )
#define R_38    RADIAN(  38 )
#define R_39    RADIAN(  39 )
#define R_40    RADIAN(  40 )
#define R_41    RADIAN(  41 )
#define R_42    RADIAN(  42 )
#define R_43    RADIAN(  43 )
#define R_44    RADIAN(  44 )
#define R_45    RADIAN(  45 )
#define R_46    RADIAN(  46 )
#define R_47    RADIAN(  47 )
#define R_48    RADIAN(  48 )
#define R_49    RADIAN(  49 )
#define R_50    RADIAN(  50 )
#define R_51    RADIAN(  51 )
#define R_52    RADIAN(  52 )
#define R_53    RADIAN(  53 )
#define R_54    RADIAN(  54 )
#define R_55    RADIAN(  55 )
#define R_56    RADIAN(  56 )
#define R_57    RADIAN(  57 )
#define R_58    RADIAN(  58 )
#define R_59    RADIAN(  59 )
#define R_60    RADIAN(  60 )
#define R_61    RADIAN(  61 )
#define R_62    RADIAN(  62 )
#define R_63    RADIAN(  63 )
#define R_64    RADIAN(  64 )
#define R_65    RADIAN(  65 )
#define R_66    RADIAN(  66 )
#define R_67    RADIAN(  67 )
#define R_68    RADIAN(  68 )
#define R_69    RADIAN(  69 )
#define R_70    RADIAN(  70 )
#define R_71    RADIAN(  71 )
#define R_72    RADIAN(  72 )
#define R_73    RADIAN(  73 )
#define R_74    RADIAN(  74 )
#define R_75    RADIAN(  75 )
#define R_76    RADIAN(  76 )
#define R_77    RADIAN(  77 )
#define R_78    RADIAN(  78 )
#define R_79    RADIAN(  79 )
#define R_80    RADIAN(  80 )
#define R_81    RADIAN(  81 )
#define R_82    RADIAN(  82 )
#define R_83    RADIAN(  83 )
#define R_84    RADIAN(  84 )
#define R_85    RADIAN(  85 )
#define R_86    RADIAN(  86 )
#define R_87    RADIAN(  87 )
#define R_88    RADIAN(  88 )
#define R_89    RADIAN(  89 )
#define R_90    RADIAN(  90 )
#define R_91    RADIAN(  91 )
#define R_92    RADIAN(  92 )
#define R_93    RADIAN(  93 )
#define R_94    RADIAN(  94 )
#define R_95    RADIAN(  95 )
#define R_96    RADIAN(  96 )
#define R_97    RADIAN(  97 )
#define R_98    RADIAN(  98 )
#define R_99    RADIAN(  99 )
#define R_100   RADIAN( 100 )
#define R_101   RADIAN( 101 )
#define R_102   RADIAN( 102 )
#define R_103   RADIAN( 103 )
#define R_104   RADIAN( 104 )
#define R_105   RADIAN( 105 )
#define R_106   RADIAN( 106 )
#define R_107   RADIAN( 107 )
#define R_108   RADIAN( 108 )
#define R_109   RADIAN( 109 )
#define R_110   RADIAN( 110 )
#define R_111   RADIAN( 111 )
#define R_112   RADIAN( 112 )
#define R_113   RADIAN( 113 )
#define R_114   RADIAN( 114 )
#define R_115   RADIAN( 115 )
#define R_116   RADIAN( 116 )
#define R_117   RADIAN( 117 )
#define R_118   RADIAN( 118 )
#define R_119   RADIAN( 119 )
#define R_120   RADIAN( 120 )
#define R_121   RADIAN( 121 )
#define R_122   RADIAN( 122 )
#define R_123   RADIAN( 123 )
#define R_124   RADIAN( 124 )
#define R_125   RADIAN( 125 )
#define R_126   RADIAN( 126 )
#define R_127   RADIAN( 127 )
#define R_128   RADIAN( 128 )
#define R_129   RADIAN( 129 )
#define R_130   RADIAN( 130 )
#define R_131   RADIAN( 131 )
#define R_132   RADIAN( 132 )
#define R_133   RADIAN( 133 )
#define R_134   RADIAN( 134 )
#define R_135   RADIAN( 135 )
#define R_136   RADIAN( 136 )
#define R_137   RADIAN( 137 )
#define R_138   RADIAN( 138 )
#define R_139   RADIAN( 139 )
#define R_140   RADIAN( 140 )
#define R_141   RADIAN( 141 )
#define R_142   RADIAN( 142 )
#define R_143   RADIAN( 143 )
#define R_144   RADIAN( 144 )
#define R_145   RADIAN( 145 )
#define R_146   RADIAN( 146 )
#define R_147   RADIAN( 147 )
#define R_148   RADIAN( 148 )
#define R_149   RADIAN( 149 )
#define R_150   RADIAN( 150 )
#define R_151   RADIAN( 151 )
#define R_152   RADIAN( 152 )
#define R_153   RADIAN( 153 )
#define R_154   RADIAN( 154 )
#define R_155   RADIAN( 155 )
#define R_156   RADIAN( 156 )
#define R_157   RADIAN( 157 )
#define R_158   RADIAN( 158 )
#define R_159   RADIAN( 159 )
#define R_160   RADIAN( 160 )
#define R_161   RADIAN( 161 )
#define R_162   RADIAN( 162 )
#define R_163   RADIAN( 163 )
#define R_164   RADIAN( 164 )
#define R_165   RADIAN( 165 )
#define R_166   RADIAN( 166 )
#define R_167   RADIAN( 167 )
#define R_168   RADIAN( 168 )
#define R_169   RADIAN( 169 )
#define R_170   RADIAN( 170 )
#define R_171   RADIAN( 171 )
#define R_172   RADIAN( 172 )
#define R_173   RADIAN( 173 )
#define R_174   RADIAN( 174 )
#define R_175   RADIAN( 175 )
#define R_176   RADIAN( 176 )
#define R_177   RADIAN( 177 )
#define R_178   RADIAN( 178 )
#define R_179   RADIAN( 179 )
#define R_180   RADIAN( 180 )
#define R_181   RADIAN( 181 )
#define R_182   RADIAN( 182 )
#define R_183   RADIAN( 183 )
#define R_184   RADIAN( 184 )
#define R_185   RADIAN( 185 )
#define R_186   RADIAN( 186 )
#define R_187   RADIAN( 187 )
#define R_188   RADIAN( 188 )
#define R_189   RADIAN( 189 )
#define R_190   RADIAN( 190 )
#define R_191   RADIAN( 191 )
#define R_192   RADIAN( 192 )
#define R_193   RADIAN( 193 )
#define R_194   RADIAN( 194 )
#define R_195   RADIAN( 195 )
#define R_196   RADIAN( 196 )
#define R_197   RADIAN( 197 )
#define R_198   RADIAN( 198 )
#define R_199   RADIAN( 199 )
#define R_200   RADIAN( 200 )
#define R_201   RADIAN( 201 )
#define R_202   RADIAN( 202 )
#define R_203   RADIAN( 203 )
#define R_204   RADIAN( 204 )
#define R_205   RADIAN( 205 )
#define R_206   RADIAN( 206 )
#define R_207   RADIAN( 207 )
#define R_208   RADIAN( 208 )
#define R_209   RADIAN( 209 )
#define R_210   RADIAN( 210 )
#define R_211   RADIAN( 211 )
#define R_212   RADIAN( 212 )
#define R_213   RADIAN( 213 )
#define R_214   RADIAN( 214 )
#define R_215   RADIAN( 215 )
#define R_216   RADIAN( 216 )
#define R_217   RADIAN( 217 )
#define R_218   RADIAN( 218 )
#define R_219   RADIAN( 219 )
#define R_220   RADIAN( 220 )
#define R_221   RADIAN( 221 )
#define R_222   RADIAN( 222 )
#define R_223   RADIAN( 223 )
#define R_224   RADIAN( 224 )
#define R_225   RADIAN( 225 )
#define R_226   RADIAN( 226 )
#define R_227   RADIAN( 227 )
#define R_228   RADIAN( 228 )
#define R_229   RADIAN( 229 )
#define R_230   RADIAN( 230 )
#define R_231   RADIAN( 231 )
#define R_232   RADIAN( 232 )
#define R_233   RADIAN( 233 )
#define R_234   RADIAN( 234 )
#define R_235   RADIAN( 235 )
#define R_236   RADIAN( 236 )
#define R_237   RADIAN( 237 )
#define R_238   RADIAN( 238 )
#define R_239   RADIAN( 239 )
#define R_240   RADIAN( 240 )
#define R_241   RADIAN( 241 )
#define R_242   RADIAN( 242 )
#define R_243   RADIAN( 243 )
#define R_244   RADIAN( 244 )
#define R_245   RADIAN( 245 )
#define R_246   RADIAN( 246 )
#define R_247   RADIAN( 247 )
#define R_248   RADIAN( 248 )
#define R_249   RADIAN( 249 )
#define R_250   RADIAN( 250 )
#define R_251   RADIAN( 251 )
#define R_252   RADIAN( 252 )
#define R_253   RADIAN( 253 )
#define R_254   RADIAN( 254 )
#define R_255   RADIAN( 255 )
#define R_256   RADIAN( 256 )
#define R_257   RADIAN( 257 )
#define R_258   RADIAN( 258 )
#define R_259   RADIAN( 259 )
#define R_260   RADIAN( 260 )
#define R_261   RADIAN( 261 )
#define R_262   RADIAN( 262 )
#define R_263   RADIAN( 263 )
#define R_264   RADIAN( 264 )
#define R_265   RADIAN( 265 )
#define R_266   RADIAN( 266 )
#define R_267   RADIAN( 267 )
#define R_268   RADIAN( 268 )
#define R_269   RADIAN( 269 )
#define R_270   RADIAN( 270 )
#define R_271   RADIAN( 271 )
#define R_272   RADIAN( 272 )
#define R_273   RADIAN( 273 )
#define R_274   RADIAN( 274 )
#define R_275   RADIAN( 275 )
#define R_276   RADIAN( 276 )
#define R_277   RADIAN( 277 )
#define R_278   RADIAN( 278 )
#define R_279   RADIAN( 279 )
#define R_280   RADIAN( 280 )
#define R_281   RADIAN( 281 )
#define R_282   RADIAN( 282 )
#define R_283   RADIAN( 283 )
#define R_284   RADIAN( 284 )
#define R_285   RADIAN( 285 )
#define R_286   RADIAN( 286 )
#define R_287   RADIAN( 287 )
#define R_288   RADIAN( 288 )
#define R_289   RADIAN( 289 )
#define R_290   RADIAN( 290 )
#define R_291   RADIAN( 291 )
#define R_292   RADIAN( 292 )
#define R_293   RADIAN( 293 )
#define R_294   RADIAN( 294 )
#define R_295   RADIAN( 295 )
#define R_296   RADIAN( 296 )
#define R_297   RADIAN( 297 )
#define R_298   RADIAN( 298 )
#define R_299   RADIAN( 299 )
#define R_300   RADIAN( 300 )
#define R_301   RADIAN( 301 )
#define R_302   RADIAN( 302 )
#define R_303   RADIAN( 303 )
#define R_304   RADIAN( 304 )
#define R_305   RADIAN( 305 )
#define R_306   RADIAN( 306 )
#define R_307   RADIAN( 307 )
#define R_308   RADIAN( 308 )
#define R_309   RADIAN( 309 )
#define R_310   RADIAN( 310 )
#define R_311   RADIAN( 311 )
#define R_312   RADIAN( 312 )
#define R_313   RADIAN( 313 )
#define R_314   RADIAN( 314 )
#define R_315   RADIAN( 315 )
#define R_316   RADIAN( 316 )
#define R_317   RADIAN( 317 )
#define R_318   RADIAN( 318 )
#define R_319   RADIAN( 319 )
#define R_320   RADIAN( 320 )
#define R_321   RADIAN( 321 )
#define R_322   RADIAN( 322 )
#define R_323   RADIAN( 323 )
#define R_324   RADIAN( 324 )
#define R_325   RADIAN( 325 )
#define R_326   RADIAN( 326 )
#define R_327   RADIAN( 327 )
#define R_328   RADIAN( 328 )
#define R_329   RADIAN( 329 )
#define R_330   RADIAN( 330 )
#define R_331   RADIAN( 331 )
#define R_332   RADIAN( 332 )
#define R_333   RADIAN( 333 )
#define R_334   RADIAN( 334 )
#define R_335   RADIAN( 335 )
#define R_336   RADIAN( 336 )
#define R_337   RADIAN( 337 )
#define R_338   RADIAN( 338 )
#define R_339   RADIAN( 339 )
#define R_340   RADIAN( 340 )
#define R_341   RADIAN( 341 )
#define R_342   RADIAN( 342 )
#define R_343   RADIAN( 343 )
#define R_344   RADIAN( 344 )
#define R_345   RADIAN( 345 )
#define R_346   RADIAN( 346 )
#define R_347   RADIAN( 347 )
#define R_348   RADIAN( 348 )
#define R_349   RADIAN( 349 )
#define R_350   RADIAN( 350 )
#define R_351   RADIAN( 351 )
#define R_352   RADIAN( 352 )
#define R_353   RADIAN( 353 )
#define R_354   RADIAN( 354 )
//
// Definitions for R_355 thru R_360 are in x_math.hpp.
//

// DOM-IGNORE-END

//==============================================================================
//  INLINE FUNCTIONS
//==============================================================================

inline f32 x_sqr ( f32 a )  { return( a * a ); }

//==============================================================================

#if 0
inline xbool x_isvalid( f32 a )
{
/*
#if (defined(TARGET_PC) && !defined(X_DEBUG))
    return TRUE;
#else
    return( ( (*((u32*)(&a))) & 0x7F800000 ) != 0x7F800000 );
#endif
*/
    return ((a>=F32_MIN) && (a<=F32_MAX));
}
#endif

//------------------------------------------------------------------------------
//  TEMPORARY VERSIONS!
//------------------------------------------------------------------------------

#include <math.h>

#if ( defined TARGET_PC || defined TARGET_XBOX )
__forceinline f32 x_sqrt    ( f32 a )        { return(                (f32)(sqrtf ( a ) ) ); }
__forceinline f32 x_1sqrt   ( f32 a )        { return(         1.0f / (f32)(sqrtf ( a ) ) ); }
__forceinline f32 x_log     ( f32 a )        { return(                (f32)(logf  ( a ) ) ); }
__forceinline f32 x_log2    ( f32 a )        { return( 1.442695041f * (f32)(logf  ( a ) ) ); }
__forceinline f32 x_log10   ( f32 a )        { return(                (f32)(log10f( a ) ) ); }
__forceinline f32 x_exp     ( f32 a )        { return(                (f32)(expf  ( a ) ) ); }
__forceinline f32 x_pow     ( f32 a, f32 b ) { return(                (f32)(powf  ( a, b ) ) ); }
__forceinline f32 x_tan     ( f32 a )        { return(                (f32)(tanf  ( a ) ) ); }
__forceinline f32 x_atan    ( f32 a )        { return(                (f32)(atanf ( a ) ) ); }
__forceinline f32 x_asin    ( f32 a )        { return(                (f32)(asinf ( a ) ) ); }
__forceinline f32 x_acos    ( f32 a )        { return(                (f32)(acosf ( a ) ) ); }
__forceinline radian x_atan2( f32 y, f32 x ) { return                 (radian)atan2f( y,x ); }
__forceinline f32 x_sin     ( radian a )     { return                 (f32)sinf( a ); }
__forceinline f32 x_cos     ( radian a )     { return                 (f32)cosf( a ); }
#endif


#ifdef TARGET_PS2
inline f32 x_sqrt  ( f32 a )        { f32 v;asm("sqrt.s %0,%1":"=f"(v):"f"(a));return v; }
inline f32 x_1sqrt ( f32 a )        { f32 v;asm("rsqrt.s %0,%2,%1":"=f"(v):"f"(a),"f"(1.0f));return v;}
inline f32 x_log   ( f32 a )        { return(                (f32)(log   ( (f64)a ) ) ); }
inline f32 x_log2  ( f32 a )        { return(                (f32)(log2f ( (f32)a ) ) ); }
inline f32 x_log10 ( f32 a )        { return(                (f32)(log10f( (f32)a ) ) ); }
inline f32 x_exp   ( f32 a )        { return(                (f32)(exp   ( (f64)a ) ) ); }
inline f32 x_pow   ( f32 a, f32 b ) { return(                (f32)(pow   ( (f64)a, (f64)b ) ) ); }
inline f32 x_tan   ( f32 a )        { return(                (f32)(tanf  ( (f32)a ) ) ); }
#endif


#ifdef TARGET_GCN
inline f32 x_sqrt  ( f32 a )        { return(                (f32)(sqrtf ( (f32)a ) ) ); }
inline f32 x_1sqrt ( f32 a )        { return(         1.0f / (f32)(sqrtf ( (f32)a ) ) ); }
inline f32 x_log   ( f32 a )        { return(                (f32)(log   ( (f64)a ) ) ); }
inline f32 x_log2  ( f32 a )        { return(                (f32)(log2f ( (f32)a ) ) ); }
inline f32 x_log10 ( f32 a )        { return(                (f32)(log10f( (f32)a ) ) ); }
inline f32 x_exp   ( f32 a )        { return(                (f32)(exp   ( (f64)a ) ) ); }
inline f32 x_pow   ( f32 a, f32 b ) { return(                (f32)(pow   ( (f64)a, (f64)b ) ) ); }

inline f32 x_tan   ( f32 a )        { return(                (f32)(tanf  ( (f32)a ) ) ); }
inline f32 x_atan  ( f32 a )        { return(                (f32)(atanf ( (f32)a ) ) ); }
inline f32 x_asin  ( f32 a )        { return(                (f32)(asinf ( (f32)a ) ) ); }
inline f32 x_acos  ( f32 a )        { return(                (f32)(acosf ( (f32)a ) ) ); }
#endif

//==============================================================================

inline
radian x_ModAngle( radian a )
{
    // TO DO:  Use the same technique here as used in x_sin to modulate.
    //         Need to compute HI and LO for 2PI.

    if( (a > RADIAN( 1440)) || 
        (a < RADIAN(-1440)) )
    {
        a = x_fmod( a, R_360 );
    }

    while( a >= R_360 )  a -= R_360;
    while( a <  R_0   )  a += R_360;

    ASSERT( (a >= (R_0-0.01f)) && (a < (R_360+0.01f)) );
    return( a );
}

//==============================================================================

inline
radian x_ModAngle2( radian a )
{
    a += R_180;
    a  = x_ModAngle( a );
    a -= R_180;
    
    return( a );
}

//==============================================================================

inline
radian x_MinAngleDiff( radian a, radian b )
{
    return( x_ModAngle2( a - b ) );
}

//==============================================================================

inline
f32 x_lpr( f32 a, f32 b )
{
    ASSERT( b > 0.0f );

    a = x_fmod( a, b );
    if( a < 0.0f )  
        a += b;
    return( a );
}

//==============================================================================

inline
f32 x_round( f32 a, f32 b )
{
    f32 Quotient;

    ASSERT( !IN_RANGE( -0.00001f, b, 0.00001f ) );

    Quotient = a / b;

    if( Quotient < 0.0f )   return( x_ceil ( Quotient - 0.5f ) * b );
    else                    return( x_floor( Quotient + 0.5f ) * b );
}

//==============================================================================

inline
xbool x_isvalid( f32 a )
{
    return( ( (*((u32*)(&a))) & 0x7F800000 ) != 0x7F800000 );
}

//==============================================================================

inline
f32 x_clamp( f32 V, f32 VMin, f32 VMax )
{
    if( V < VMin ) V = VMin;
    if( V > VMax ) V = VMax;
    return V;
}

//==============================================================================

inline
f32 x_parametric( f32 V, f32 ValueAtT0, f32 ValueAtT1, xbool bClamp )
{
    ASSERT( ValueAtT0 != ValueAtT1 );
    V = (V - ValueAtT0) / (ValueAtT1 - ValueAtT0);
    if( bClamp ) V = x_clamp( V, 0, 1 );
    return V;
}

//==============================================================================


